# Binary indicator for rail proximity.
Near_Rail = ifelse(Dist_to_Rail_mi <= 1.0, 1, 0)
)
cat("Rail Accessibility Classification:\n")
tract_rail_distance %>%
count(Rail_Access) %>%
mutate(Pct = n / sum(n) * 100) %>%
kable(digits = 1, col.names = c("Rail Access Category", "N Tracts", "Percent")) %>%
kable_styling(bootstrap_options = c("striped", "hover"))
# Join distance metrics to main ridership dataframe.
df_clean_with_rail <- df_clean %>%
left_join(
tract_rail_distance %>%
select(GEOID, Dist_to_Rail_mi, Dist_to_Rail_km,
Rail_Access, Near_Rail, Nearest_Station, Nearest_Line),
by = c("Census_Tract_ID" = "GEOID")
)
cat("Ridership Data Enhanced with Rail Distance:\n")
cat(sprintf("Total Observations: %s\n", comma(nrow(df_clean_with_rail))))
cat(sprintf("Observations with Rail Distance: %s\n",
comma(sum(!is.na(df_clean_with_rail$Dist_to_Rail_mi)))))
cat(sprintf("Missing Rail Distance: %s\n",
comma(sum(is.na(df_clean_with_rail$Dist_to_Rail_mi)))))
# Check first few rows.
cat("\nFirst 10 Rows with Rail Distance:\n")
df_clean_with_rail %>%
filter(!is.na(Dist_to_Rail_mi)) %>%
select(Census_Tract_ID, Year, On_, Dist_to_Rail_mi, Rail_Access, Nearest_Station) %>%
head(10) %>%
kable(digits = 2) %>%
kable_styling(bootstrap_options = c("striped", "hover"))
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 12
# Create choropleth map showing distance to rail.
tract_with_distance <- tract_septa %>%
left_join(
tract_rail_distance %>% select(GEOID, Dist_to_Rail_mi, Rail_Access),
by = "GEOID"
)
# Transform back to WGS84 for plotting.
tract_with_distance_wgs84 <- tract_with_distance %>%
st_transform(4326)
rr_stations_wgs84 <- rr_stations_sf %>%
st_transform(4326)
# Create map.
distance_map <- ggplot() +
geom_sf(data = tract_with_distance_wgs84,
aes(fill = Dist_to_Rail_mi),
color = "white", linewidth = 0.1) +
geom_sf(data = rr_stations_wgs84,
color = "#E74C3C", size = 2, shape = 17) +
scale_fill_viridis_c(
option = "magma",
direction = -1,
name = "Distance\n(miles)",
labels = comma
) +
labs(
title = "Distance to Nearest Regional Rail Station by Census Tract",
subtitle = "Red triangles = Regional Rail stations | Darker tracts = farther from rail",
caption = "Data: SEPTA Regional Rail Stations & Census Tracts"
) +
theme_void() +
theme(
plot.title = element_text(face = "bold", size = 14),
legend.position = "right"
)
distance_map
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 12
# Create categorical map showing rail accessibility zones.
access_map <- ggplot() +
geom_sf(data = tract_with_distance_wgs84,
aes(fill = Rail_Access),
color = "white", linewidth = 0.1) +
geom_sf(data = rr_stations_wgs84,
color = "black", size = 2.5, shape = 17) +
scale_fill_manual(
values = c(
"Very Close (≤0.5 mi)" = "#27AE60",
"Close (0.5-1 mi)" = "#F39C12",
"Moderate (1-2 mi)" = "#E67E22",
"Far (2-5 mi)" = "#E74C3C",
"Very Far (>5 mi)" = "#8E44AD"
),
name = "Rail\nAccessibility"
) +
labs(
title = "Rail Accessibility Classification by Census Tract",
subtitle = "Black triangles = Regional Rail stations | Color indicates distance band",
caption = "Data: SEPTA Regional Rail Stations & Census Tracts"
) +
theme_void() +
theme(
plot.title = element_text(face = "bold", size = 14),
legend.position = "right"
)
access_map
#| fig-dpi: 300
#| fig-height: 7
#| fig-width: 12
# Calculate mean ridership by rail accessibility category.
ridership_by_access <- df_clean_with_rail %>%
filter(Day_of_Week == "Weekday", !is.na(Rail_Access)) %>%
group_by(Rail_Access, Year) %>%
summarize(
Mean_On = mean(On_, na.rm = TRUE),
Median_On = median(On_, na.rm = TRUE),
N_Tracts = n_distinct(Census_Tract_ID),
.groups = "drop"
)
# Create line plot showing trends by rail accessibility.
access_trend_plot <- ggplot(ridership_by_access,
aes(x = Year, y = Mean_On, color = Rail_Access, group = Rail_Access)) +
geom_line(linewidth = 1.2) +
geom_point(size = 3) +
scale_color_manual(
values = c(
"Very Close (≤0.5 mi)" = "#27AE60",
"Close (0.5-1 mi)" = "#F39C12",
"Moderate (1-2 mi)" = "#E67E22",
"Far (2-5 mi)" = "#E74C3C",
"Very Far (>5 mi)" = "#8E44AD"
),
name = "Rail Accessibility"
) +
scale_y_continuous(labels = comma) +
labs(
title = "Mean Weekday Bus Ridership by Rail Accessibility (2014-2023)",
subtitle = "Tracts closer to rail show different ridership patterns and recovery trajectories",
x = "Year",
y = "Mean Weekday Boardings per Tract",
caption = "Data: SEPTA Bus Ridership & Regional Rail Stations"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14),
legend.position = "bottom"
)
access_trend_plot
#| fig-dpi: 300
#| fig-height: 7
#| fig-width: 12
# Create scatter plot for 2023 ridership versus distance.
ridership_2023 <- df_clean_with_rail %>%
filter(Day_of_Week == "Weekday", Year == 2023, !is.na(Dist_to_Rail_mi))
# Calculate correlation.
dist_ridership_cor <- cor(ridership_2023$Dist_to_Rail_mi,
ridership_2023$On_,
use = "complete.obs")
# Create hex plot.
distance_scatter <- ggplot(ridership_2023,
aes(x = Dist_to_Rail_mi, y = On_ + 1)) +
geom_hex(bins = 50) +
geom_smooth(method = "loess", se = TRUE, color = "#E74C3C", linewidth = 1.3) +
scale_fill_viridis_c(option = "plasma", trans = "log10", labels = comma, name = "Tract\nCount") +
scale_y_log10(labels = comma) +
annotate("text", x = max(ridership_2023$Dist_to_Rail_mi) * 0.7, y = 10,
label = sprintf("Correlation: %.3f", dist_ridership_cor),
size = 5, fontface = "bold") +
labs(
title = "Bus Ridership vs Distance to Nearest Rail Station (2023)",
subtitle = "Each hex represents multiple census tracts | LOESS curve shows relationship",
x = "Distance to Nearest Rail Station (miles)",
y = "Weekday Boardings (Log Scale)",
caption = "Data: SEPTA 2023 Weekday Bus Ridership"
) +
theme_minimal(base_size = 12) +
theme(plot.title = element_text(face = "bold", size = 14))
distance_scatter
cat(sprintf("\nCorrelation: Distance to Rail vs Ridership = %.4f\n", dist_ridership_cor))
cat("Interpretation: Negative = substitution | Positive = complementarity\n")
#| fig-dpi: 300
#| fig-height: 7
#| fig-width: 12
# Create box plot showing ridership distribution by distance band.
distance_boxplot <- ridership_2023 %>%
filter(On_ > 0) %>%
ggplot(aes(x = Rail_Access, y = On_ + 1, fill = Rail_Access)) +
geom_boxplot(outlier.alpha = 0.3, outlier.size = 1) +
scale_y_log10(labels = comma) +
scale_fill_manual(
values = c(
"Very Close (≤0.5 mi)" = "#27AE60",
"Close (0.5-1 mi)" = "#F39C12",
"Moderate (1-2 mi)" = "#E67E22",
"Far (2-5 mi)" = "#E74C3C",
"Very Far (>5 mi)" = "#8E44AD"
)
) +
labs(
title = "Bus Ridership Distribution by Rail Accessibility (2023)",
subtitle = "Box plots show median, quartiles, and outliers | Log scale for clarity",
x = "Rail Accessibility Category",
y = "Weekday Boardings (Log Scale)",
caption = "Data: SEPTA 2023 Weekday Bus Ridership | Positive ridership only"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14),
legend.position = "none",
axis.text.x = element_text(angle = 45, hjust = 1)
)
distance_boxplot
# Perform t-test comparing near versus far tracts.
near_rail_ridership <- ridership_2023 %>%
filter(Near_Rail == 1) %>%
pull(On_)
far_rail_ridership <- ridership_2023 %>%
filter(Near_Rail == 0) %>%
pull(On_)
t_test_result <- t.test(near_rail_ridership, far_rail_ridership)
cat("T-Test: Near Rail (≤1 mile) vs Far Rail (>1 mile)\n")
cat("==================================================\n\n")
cat(sprintf("Near Rail Mean: %.2f boardings\n", mean(near_rail_ridership)))
cat(sprintf("Far Rail Mean: %.2f boardings\n", mean(far_rail_ridership)))
cat(sprintf("Difference: %.2f boardings\n", mean(near_rail_ridership) - mean(far_rail_ridership)))
cat(sprintf("\nt-statistic: %.4f\n", t_test_result$statistic))
cat(sprintf("p-value: %.4f\n", t_test_result$p.value))
cat(sprintf("95%% CI: [%.2f, %.2f]\n", t_test_result$conf.int[1], t_test_result$conf.int[2]))
if (t_test_result$p.value < 0.05) {
cat("\nResult: STATISTICALLY SIGNIFICANT difference\n")
if (mean(near_rail_ridership) > mean(far_rail_ridership)) {
cat("Interpretation: Tracts near rail have HIGHER bus ridership (feeder effect)\n")
} else {
cat("Interpretation: Tracts near rail have LOWER bus ridership (substitution effect)\n")
}
} else {
cat("\nResult: No statistically significant difference\n")
cat("Interpretation: Rail proximity does not significantly affect bus ridership\n")
}
# Calculate recovery ratios by rail accessibility.
recovery_by_access <- df_clean_with_rail %>%
filter(Day_of_Week == "Weekday", Year %in% c(2019, 2023), !is.na(Rail_Access)) %>%
group_by(Census_Tract_ID, Rail_Access) %>%
summarize(
Ridership_2019 = sum(On_[Year == 2019]),
Ridership_2023 = sum(On_[Year == 2023]),
.groups = "drop"
) %>%
filter(Ridership_2019 > 0) %>%
mutate(Recovery_Ratio = Ridership_2023 / Ridership_2019)
cat("Recovery Analysis by Rail Accessibility:\n")
recovery_by_access %>%
group_by(Rail_Access) %>%
summarize(
N_Tracts = n(),
Mean_Recovery = mean(Recovery_Ratio),
Median_Recovery = median(Recovery_Ratio),
.groups = "drop"
) %>%
kable(digits = 3,
col.names = c("Rail Access", "N Tracts", "Mean Recovery", "Median Recovery")) %>%
kable_styling(bootstrap_options = c("striped", "hover"))
#| fig-dpi: 300
#| fig-height: 7
#| fig-width: 12
# Create violin plot showing recovery distribution.
recovery_violin <- ggplot(recovery_by_access,
aes(x = Rail_Access, y = Recovery_Ratio, fill = Rail_Access)) +
geom_violin(alpha = 0.7, draw_quantiles = c(0.25, 0.5, 0.75)) +
geom_hline(yintercept = 1.0, linetype = "dashed", color = "black", linewidth = 0.8) +
scale_fill_manual(
values = c(
"Very Close (≤0.5 mi)" = "#27AE60",
"Close (0.5-1 mi)" = "#F39C12",
"Moderate (1-2 mi)" = "#E67E22",
"Far (2-5 mi)" = "#E74C3C",
"Very Far (>5 mi)" = "#8E44AD"
)
) +
labs(
title = "Recovery Ratio Distribution by Rail Accessibility (2023 vs 2019)",
subtitle = "Horizontal lines show quartiles | Dashed line = full recovery",
x = "Rail Accessibility Category",
y = "Recovery Ratio (2023 / 2019)",
caption = "Data: SEPTA Weekday Bus Ridership"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14),
legend.position = "none",
axis.text.x = element_text(angle = 45, hjust = 1)
)
recovery_violin
# Create buffer zones around rail stations.
rail_buffers_half_mile <- rr_stations_sf %>%
st_buffer(dist = 804.67)
rail_buffers_one_mile <- rr_stations_sf %>%
st_buffer(dist = 1609.34)
cat("Rail Station Buffer Zones Created:\n")
cat(sprintf("Half-Mile Buffers: %s\n", nrow(rail_buffers_half_mile)))
cat(sprintf("One-Mile Buffers: %s\n", nrow(rail_buffers_one_mile)))
# Identify tracts within half-mile buffer.
tracts_within_half_mile <- tract_septa %>%
st_join(
rail_buffers_half_mile %>% select(Station, Line, Total_Weekday_Boards),
join = st_intersects
) %>%
filter(!is.na(Station)) %>%
group_by(GEOID) %>%
slice_max(Total_Weekday_Boards, n = 1, with_ties = FALSE) %>%
ungroup() %>%
st_drop_geometry() %>%
select(GEOID, Station_Half_Mile = Station, Line_Half_Mile = Line)
# Identify tracts within one-mile buffer.
tracts_within_one_mile <- tract_septa %>%
st_join(
rail_buffers_one_mile %>% select(Station, Line, Total_Weekday_Boards),
join = st_intersects
) %>%
filter(!is.na(Station)) %>%
group_by(GEOID) %>%
slice_max(Total_Weekday_Boards, n = 1, with_ties = FALSE) %>%
ungroup() %>%
st_drop_geometry() %>%
select(GEOID, Station_One_Mile = Station, Line_One_Mile = Line)
cat("Tracts Within Rail Station Buffers:\n")
cat(sprintf("Tracts within 0.5 miles of rail: %s (%.1f%%)\n",
n_distinct(tracts_within_half_mile$GEOID),
n_distinct(tracts_within_half_mile$GEOID) / n_distinct(tract_septa$GEOID) * 100))
cat(sprintf("Tracts within 1.0 miles of rail: %s (%.1f%%)\n",
n_distinct(tracts_within_one_mile$GEOID),
n_distinct(tracts_within_one_mile$GEOID) / n_distinct(tract_septa$GEOID) * 100))
# Join buffer indicators to ridership data.
df_clean_with_rail_buffers <- df_clean_with_rail %>%
left_join(tracts_within_half_mile, by = c("Census_Tract_ID" = "GEOID")) %>%
left_join(tracts_within_one_mile, by = c("Census_Tract_ID" = "GEOID")) %>%
mutate(
Within_Half_Mile = ifelse(!is.na(Station_Half_Mile), 1, 0),
Within_One_Mile = ifelse(!is.na(Station_One_Mile), 1, 0)
)
cat("Enhanced Dataset with Buffer Indicators:\n")
cat(sprintf("Total Observations: %s\n", comma(nrow(df_clean_with_rail_buffers))))
cat(sprintf("Observations within 0.5 miles: %s (%.1f%%)\n",
comma(sum(df_clean_with_rail_buffers$Within_Half_Mile)),
mean(df_clean_with_rail_buffers$Within_Half_Mile) * 100))
cat(sprintf("Observations within 1.0 miles: %s (%.1f%%)\n",
comma(sum(df_clean_with_rail_buffers$Within_One_Mile)),
mean(df_clean_with_rail_buffers$Within_One_Mile) * 100))
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 12
# Transform buffers to WGS84 for plotting.
rail_buffers_half_mile_wgs84 <- rail_buffers_half_mile %>% st_transform(4326)
rail_buffers_one_mile_wgs84 <- rail_buffers_one_mile %>% st_transform(4326)
# Create buffer map.
buffer_map <- ggplot() +
geom_sf(data = tract_with_distance_wgs84,
fill = "gray95", color = "gray70", linewidth = 0.1) +
geom_sf(data = rail_buffers_one_mile_wgs84,
fill = "#3498DB", alpha = 0.2, color = NA) +
geom_sf(data = rail_buffers_half_mile_wgs84,
fill = "#E74C3C", alpha = 0.3, color = NA) +
geom_sf(data = rr_stations_wgs84,
color = "black", size = 2.5, shape = 17) +
labs(
title = "Regional Rail Station Catchment Areas",
subtitle = "Red = 0.5 mile buffer | Blue = 1.0 mile buffer | Black triangles = stations",
caption = "Data: SEPTA Regional Rail Stations & Census Tracts"
) +
theme_void() +
theme(plot.title = element_text(face = "bold", size = 14))
buffer_map
# Filter to 2023 weekday data for cross-sectional analysis.
model_data_2023 <- df_clean_with_rail_buffers %>%
filter(Day_of_Week == "Weekday", Year == 2023, !is.na(Dist_to_Rail_mi))
# Estimate simple linear regression.
lm_simple <- lm(log(On_ + 1) ~ Dist_to_Rail_mi, data = model_data_2023)
cat("Simple Linear Model: log(Ridership) ~ Distance to Rail\n")
cat("======================================================\n\n")
summary(lm_simple)
cat("\nInterpretation:\n")
cat(sprintf("Coefficient: %.4f\n", coef(lm_simple)[2]))
if (coef(lm_simple)[2] < 0) {
cat("Negative coefficient indicates tracts farther from rail have LOWER ridership\n")
cat("This suggests bus-rail COMPLEMENTARITY (feeder effect)\n")
} else {
cat("Positive coefficient indicates tracts farther from rail have HIGHER ridership\n")
cat("This suggests bus-rail SUBSTITUTION (competition effect)\n")
}
# Estimate model with county fixed effects.
lm_county_fe <- lm(
log(On_ + 1) ~ Dist_to_Rail_mi + County_Name,
data = model_data_2023
)
cat("\nMultiple Regression: log(Ridership) ~ Distance + County FE\n")
cat("==========================================================\n\n")
summary(lm_county_fe)
cat("\nKey Findings:\n")
cat(sprintf("Distance Coefficient: %.4f\n", coef(lm_county_fe)[2]))
cat(sprintf("R-squared: %.4f\n", summary(lm_county_fe)$r.squared))
cat(sprintf("Adjusted R-squared: %.4f\n", summary(lm_county_fe)$adj.r.squared))
# Estimate model using binary proximity indicator.
lm_binary <- lm(
log(On_ + 1) ~ Within_One_Mile + County_Name,
data = model_data_2023
)
cat("\nBinary Proximity Model: log(Ridership) ~ Within 1 Mile + County FE\n")
cat("==================================================================\n\n")
summary(lm_binary)
cat("\nInterpretation:\n")
if (coef(lm_binary)[2] > 0) {
cat(sprintf("Tracts within 1 mile of rail have %.1f%% HIGHER ridership\n",
(exp(coef(lm_binary)[2]) - 1) * 100))
} else {
cat(sprintf("Tracts within 1 mile of rail have %.1f%% LOWER ridership\n",
abs((exp(coef(lm_binary)[2]) - 1) * 100)))
}
cat("\n")
cat("=" , rep("=", 70), "\n", sep = "")
cat("SPATIAL ANALYSIS: BUS-RAIL INTERACTION FINDINGS\n")
cat("=" , rep("=", 70), "\n", sep = "")
cat("\n1. DISTANCE TO RAIL METRICS:\n")
cat(sprintf("   - Mean Distance: %.2f miles\n", mean(tract_rail_distance$Dist_to_Rail_mi)))
cat(sprintf("   - Median Distance: %.2f miles\n", median(tract_rail_distance$Dist_to_Rail_mi)))
cat(sprintf("   - Tracts within 1 mile: %.1f%%\n",
mean(tract_rail_distance$Near_Rail) * 100))
cat("\n2. RIDERSHIP PATTERNS BY RAIL PROXIMITY:\n")
cat(sprintf("   - Correlation (Distance vs Ridership): %.4f\n", dist_ridership_cor))
cat(sprintf("   - Near Rail Mean: %.1f boardings\n", mean(near_rail_ridership)))
cat(sprintf("   - Far Rail Mean: %.1f boardings\n", mean(far_rail_ridership)))
cat(sprintf("   - Statistical Significance: p = %.4f\n", t_test_result$p.value))
cat("\n3. RECOVERY PATTERNS:\n")
near_recovery <- recovery_by_access %>%
filter(Rail_Access %in% c("Very Close (≤0.5 mi)", "Close (0.5-1 mi)")) %>%
pull(Recovery_Ratio) %>%
mean()
far_recovery <- recovery_by_access %>%
filter(Rail_Access %in% c("Far (2-5 mi)", "Very Far (>5 mi)")) %>%
pull(Recovery_Ratio) %>%
mean()
cat(sprintf("   - Near Rail Recovery: %.1f%%\n", near_recovery * 100))
cat(sprintf("   - Far Rail Recovery: %.1f%%\n", far_recovery * 100))
cat("\n4. REGRESSION RESULTS:\n")
cat(sprintf("   - Distance Coefficient: %.4f\n", coef(lm_county_fe)[2]))
cat(sprintf("   - Within 1 Mile Effect: %.4f log points\n", coef(lm_binary)[2]))
cat(sprintf("   - Model R-squared: %.4f\n", summary(lm_county_fe)$r.squared))
cat("\n5. KEY INTERPRETATION:\n")
if (coef(lm_county_fe)[2] < 0) {
cat("   ✓ COMPLEMENTARITY: Tracts near rail have higher bus ridership\n")
cat("   ✓ Feeder Effect: Buses serve as first/last mile connectors\n")
cat("   → Policy: Enhance bus-rail integration at transfer points\n")
} else {
cat("   ✓ SUBSTITUTION: Tracts near rail have lower bus ridership\n")
cat("   ✓ Competition Effect: Rail reduces bus demand in service area\n")
cat("   → Policy: Target bus expansion to rail-underserved areas\n")
}
cat("\n6. UNDERSERVED TRACTS:\n")
underserved <- tract_rail_distance %>%
filter(Dist_to_Rail_mi > 2.0)
cat(sprintf("   - Tracts >2 miles from rail: %s (%.1f%%)\n",
nrow(underserved),
nrow(underserved) / nrow(tract_rail_distance) * 100))
cat("   → These tracts are bus-dependent and should be prioritized\n")
cat("\n" , rep("=", 71), "\n", sep = "")
# Export final dataset with all spatial metrics for modeling.
df_final_with_spatial <- df_clean_with_rail_buffers %>%
select(
Census_Tract_ID, County_Name, Year, Day_of_Week,
On_, Off_,
Dist_to_Rail_mi, Dist_to_Rail_km,
Rail_Access, Near_Rail,
Within_Half_Mile, Within_One_Mile,
Nearest_Station, Nearest_Line
)
# Save for modeling phase.
# write_csv(df_final_with_spatial, "data/septa_with_spatial_rail_metrics.csv")
cat("\nFinal Dataset with Spatial Metrics:\n")
cat(sprintf("Observations: %s\n", comma(nrow(df_final_with_spatial))))
cat(sprintf("Variables: %d\n", ncol(df_final_with_spatial)))
cat("\nKey Variables Added:\n")
cat("  - Dist_to_Rail_mi: Continuous distance to nearest station\n")
cat("  - Rail_Access: Categorical proximity classification\n")
cat("  - Near_Rail: Binary indicator (within 1 mile)\n")
cat("  - Within_Half_Mile: Binary buffer indicator\n")
cat("  - Nearest_Station: Name of closest rail station\n")
cat("\nReady for Negative Binomial model with spatial rail features!\n")
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
# Create scatter plot for 2023 ridership versus distance.
ridership_2023 <- df_clean_with_rail %>%
filter(Day_of_Week == "Weekday", Year == 2023, !is.na(Dist_to_Rail_mi))
# Calculate correlation.
dist_ridership_cor <- cor(ridership_2023$Dist_to_Rail_mi,
ridership_2023$On_,
use = "complete.obs")
# Create hex plot.
distance_scatter <- ggplot(ridership_2023,
aes(x = Dist_to_Rail_mi, y = On_ + 1)) +
geom_hex(bins = 50) +
geom_smooth(method = "loess", se = TRUE, color = "#E74C3C", linewidth = 1.3) +
scale_fill_viridis_c(option = "plasma", trans = "log10", labels = comma, name = "Tract\nCount") +
scale_y_log10(labels = comma) +
annotate("text", x = max(ridership_2023$Dist_to_Rail_mi) * 0.7, y = 10,
label = sprintf("Correlation: %.3f", dist_ridership_cor),
size = 5, fontface = "bold") +
labs(
title = "Bus Ridership vs Distance to Nearest Rail Station (2023)",
subtitle = "Each hex represents multiple census tracts | LOESS curve shows relationship",
x = "Distance to Nearest Rail Station (miles)",
y = "Weekday Boardings (Log Scale)",
caption = "Data: SEPTA 2023 Weekday Bus Ridership"
) +
theme_minimal(base_size = 12) +
theme(plot.title = element_text(face = "bold", size = 14))
distance_scatter
cat(sprintf("\nCorrelation: Distance to Rail vs Ridership = %.4f\n", dist_ridership_cor))
cat("Interpretation: Negative = substitution | Positive = complementarity\n")

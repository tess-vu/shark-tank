"0","#| fig-dpi: 300"
"0","#| fig-height: 7"
"0","#| fig-width: 12"
"0",""
"0","# Calculate risk category distribution by racial majority."
"0","risk_by_race <- df_test_risk %>%"
"0","  filter(!is.na(racial_majority), racial_majority != """") %>%"
"0","  group_by(racial_majority, risk_category) %>%"
"0","  summarize(n = n(), .groups = ""drop"") %>%"
"0","  group_by(racial_majority) %>%"
"0","  mutate(pct = n / sum(n) * 100) %>%"
"0","  ungroup()"
"0",""
"0","# Create stacked bar plot."
"0","risk_race_plot <- risk_by_race %>%"
"0","  ggplot(aes(x = racial_majority, y = pct, fill = risk_category)) +"
"0","  geom_col(width = 0.7) +"
"0","  scale_fill_viridis_d(option = ""plasma"", direction = -1) +"
"0","  scale_y_continuous(labels = percent_format(scale = 1)) +"
"0","  labs("
"0","    title = ""Distribution of Risk Categories by Tract Racial Majority"","
"0","    subtitle = ""Black-majority tracts disproportionately classified as high risk"","
"0","    x = ""Tract Racial Majority"","
"0","    y = ""Percentage of Tract-Months"","
"0","    fill = ""Risk\nCategory"","
"0","    caption = ""Data: Philadelphia Eviction Filings 2024-2025 Test Set"""
"0","  ) +"
"0","  theme_minimal(base_size = 12) +"
"0","  theme("
"0","    plot.title = element_text(face = ""bold"", size = 14),"
"0","    legend.position = ""right"""
"0","  )"
"0",""
"0","# Display risk by race plot."
"0","risk_race_plot"

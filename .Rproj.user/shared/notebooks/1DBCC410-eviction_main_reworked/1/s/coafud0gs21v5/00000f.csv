"0","# Create lagged features."
"0","# When predicting month t, we can only use data from months t-1, t-2, t-3, etc."
"0","df_model_prep <- df_monthly %>%"
"0","  filter(GEOID != ""sealed"", !is.na(GEOID), GEOID != """") %>%"
"0","  arrange(GEOID, date) %>%"
"0","  group_by(GEOID) %>%"
"0","  mutate("
"0","    # One month lag captures immediate momentum."
"0","    filings_lag1 = lag(filings_count, n = 1, order_by = date),"
"0","    # Two month lag captures medium-term trend."
"0","    filings_lag2 = lag(filings_count, n = 2, order_by = date),"
"0","    # Three month lag captures quarterly pattern."
"0","    filings_lag3 = lag(filings_count, n = 3, order_by = date),"
"0","    # Rolling 3-month average of lagged values (t-1, t-2, t-3)."
"0","    # Original rollmean with align = ""right"" included current month, please don't change this."
"0","    filings_ma3 = (filings_lag1 + filings_lag2 + filings_lag3) / 3"
"0","  ) %>%"
"0","  ungroup()"
"0",""
"0","# Check missingness of lag variables."
"0","lag_coverage <- df_model_prep %>%"
"0","  summarize("
"0","    total_obs = n(),"
"0","    missing_lag1 = sum(is.na(filings_lag1)),"
"0","    missing_lag2 = sum(is.na(filings_lag2)),"
"0","    missing_lag3 = sum(is.na(filings_lag3)),"
"0","    missing_ma3 = sum(is.na(filings_ma3)),"
"0","    pct_missing_lag1 = missing_lag1 / total_obs * 100,"
"0","    pct_missing_lag2 = missing_lag2 / total_obs * 100,"
"0","    pct_missing_lag3 = missing_lag3 / total_obs * 100,"
"0","    pct_missing_ma3 = missing_ma3 / total_obs * 100"
"0","  )"
"0",""
"0","# Display lag coverage stats."
"0","lag_coverage %>%"
"0","  kable(digits = 1, caption = ""Lagged Variable Coverage Stats"") %>%"
"0","  kable_styling(bootstrap_options = c(""striped"", ""hover""))"
